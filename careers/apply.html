<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Apply - PRL Insights & Partners</title>
  <link rel="stylesheet" href="../assets/style.css">
  <link rel="stylesheet" href="apply.css">
  <link rel="stylesheet" href="careers.css">
  <link rel="icon" href="/assets/images/favicon.ico" type="/x-icon">

</head>
<body>
  <script src="../assets/navbar.js"></script>

  <main class="apply-main" style="max-width:1100px;margin:2.5rem auto;">

     <!-- Hero Section -->
	<section class="hero">
		<div class="container">
  <div class="section-header">
    <h1>Careers</h1>
   </div>
	</section>

    <div class="apply-grid">
    <section class="job-details">
      <h1 id="job-title">Job Title</h1>
      <div id="job-meta" class="job-meta">Type &mdash; Location</div>
      <div id="job-description" class="job-description">Job Description</div>
    </section>
    
    <script>
      // Robust job details loader: read URL params, prefill header, then try to load description from careers-data.json
      (function(){
        const params = new URLSearchParams(window.location.search);
        // URLSearchParams.get returns decoded values
        const urlTitle = params.get('title') || '';
        const urlType = params.get('type') || '';
        const urlLocation = params.get('location') || '';
        const urlTeam = params.get('team') || '';

        function normalize(str){
          return String(str || '')
            .toLowerCase()
            .replace(/\s+/g,' ')
            .replace(/[\u2018\u2019\u201c\u201d]/g, "'")
            .replace(/[^\w\s\-\/]/g,'')
            .trim();
        }

        function getJobDescriptionField(job){
          if (!job) return undefined;
          return job.description || job['job-description'] || job.jobDescription || job.desc;
        }

        function render(jobObj, teamName){
          const titleText = (jobObj && jobObj.title) ? jobObj.title : (urlTitle || 'Job Title');
          const typeText = (jobObj && jobObj.type) ? jobObj.type : (urlType || 'Type');
          const locationText = (jobObj && jobObj.location) ? jobObj.location : (urlLocation || 'Location');

          const titleEl = document.getElementById('job-title');
          const metaEl = document.getElementById('job-meta');
          const descEl = document.getElementById('job-description');
          const hidden = document.getElementById('hidden-job-title');

          if (titleEl) titleEl.textContent = titleText;
          if (metaEl) metaEl.innerHTML = typeText + ' &mdash; ' + locationText + (teamName ? (' &nbsp; <small class="job-team">'+teamName+'</small>') : '');
          if (hidden) hidden.value = titleText;

          const jd = getJobDescriptionField(jobObj);
          if (jd && descEl) descEl.innerHTML = '<p>' + jd + '</p>';
        }

        // show URL-derived header quickly
        render(null, urlTeam);

        // fetch careers data from the same directory
        fetch('careers-data.json')
          .then(r => {
            if (!r.ok) throw new Error('Fetch failed: '+r.status);
            return r.json();
          })
          .then(data => {
            if (!Array.isArray(data)) return;
            const nTitle = normalize(urlTitle);
            let found = null;
            data.forEach(section => {
              if (found) return;
              (section.jobs || []).forEach(job => {
                if (found) return;
                const nJob = normalize(job.title || '');
                if (nJob && nTitle && (nJob === nTitle || nJob.includes(nTitle) || nTitle.includes(nJob))) {
                  found = { job: job, team: section.team || '' };
                }
              });
            });
            if (found) {
              render(found.job, found.team);
            }
          })
          .catch(err => {
            console.warn('Could not load careers-data.json:', err);
          });
      })();
    </script>

      <aside class="apply-form">
        <div class="form-card">
          <h2>Apply Now</h2>
          <!-- Replaced the in-page application form with a Tally embed -->
          <div class="tally-embed">
            <iframe data-tally-src="https://tally.so/embed/7RlVpP?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=1" loading="lazy" width="100%" height="710" frameborder="0" marginheight="0" marginwidth="0" title="Apply Now"></iframe>
            <script>var d=document,w="https://tally.so/widgets/embed.js",v=function(){"undefined"!=typeof Tally?Tally.loadEmbeds():d.querySelectorAll("iframe[data-tally-src]:not([src])").forEach((function(e){e.src=e.dataset.tallySrc}))};if("undefined"!=typeof Tally)v();else if(d.querySelector('script[src="'+w+'"]')==null){var s=d.createElement("script");s.src=w,s.onload=v,s.onerror=v,d.body.appendChild(s);}</script>
          </div>
        </div>
      </aside>
    </div>
  </main>

   <script src="careers.js"></script>
  <script src="../assets/footer.js"></script>

</body>
</html>
